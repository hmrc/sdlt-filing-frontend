@*
 * Copyright 2025 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import views.html.components._
@import uk.gov.hmrc.govukfrontend.views.html.components._
@import viewmodels.CaptionSize.Large

@this(
        layout: templates.Layout,
        govukButton: GovukButton,
        govukSummaryList: GovukSummaryList,
        govukErrorSummary: GovukErrorSummary,
        formHelper: FormWithCSRF,
        govukRadios: GovukRadios,
        p: Paragraph,
        h1: h1,
        caption: Caption,
        govukNotificationBanner: GovukNotificationBanner
)

@(
        maybeSummaryList: Option[SummaryList],
        form: Form[_],
        mode: Mode
)(implicit request: Request[_], messages: Messages)

@layout(pageTitle = title(form, messages("purchaserAgent.overview.title"))) {

    @request.flash.get("purchaserAgentDeleted").map { purchaserAgentName =>
        @govukNotificationBanner(
            NotificationBanner(
                title = messages("site.success"),
                content = HtmlContent(
                    s"""<h3 class="govuk-notification-banner__heading">${
                        messages(
                            "site.overview.removed",
                            if(!purchaserAgentName.isBlank) purchaserAgentName else messages("site.agent.anAgent")
                        )
                    }</h3>"""
                ),
                bannerType = Some("success"),
                role = Some("alert")
            )
        )
    }

    @request.flash.get("purchaserAgentCreated").map { purchaserAgentName =>
        @govukNotificationBanner(
            NotificationBanner(
                title = messages("site.success"),
                content = HtmlContent(
                    s"""<h3 class="govuk-notification-banner__heading">${
                        messages(
                            "site.overview.created",
                            if(!purchaserAgentName.isBlank) purchaserAgentName else messages("site.agent.anAgent")
                        )
                    }</h3>"""
                ),
                bannerType = Some("success"),
                role = Some("alert")
            )
        )
    }

    @request.flash.get("purchaserAgentUpdated").map { purchaserAgentName =>
        @govukNotificationBanner(
            NotificationBanner(
                title = messages("site.success"),
                content = HtmlContent(
                    s"""<h3 class="govuk-notification-banner__heading">${
                        messages(
                            "site.overview.updated",
                            if(!purchaserAgentName.isBlank) purchaserAgentName else messages("site.agent.anAgent")
                        )
                    }</h3>"""
                ),
                bannerType = Some("success"),
                role = Some("alert")
            )
        )
    }

    @formHelper(action = controllers.purchaserAgent.routes.PurchaserAgentOverviewController.onSubmit(), Symbol("autoComplete") -> "off") {
        @if(form.errors.nonEmpty) {
            @govukErrorSummary(ErrorSummaryViewModel(form))
        }

        @caption(messages("site.purchaserAgent.caption"), size = Large)
        @h1(messages("purchaserAgent.overview.heading"))

        @maybeSummaryList match {
            case Some(summary) => {
                @govukSummaryList(summary)

                @govukButton(
                    ButtonViewModel(messages("site.continue"))
                )
            }

            case None => {
                @p(messages("purchaserAgent.overview.noPurchaser.p1"))

                @govukRadios(
                    RadiosViewModel.yesNo(
                        field = form("value"),
                        legend = LegendViewModel(messages("purchaserAgent.overview.noPurchaser.subHeadingNoPurchasers")).asPageSubHeading()
                    )
                )

                @govukButton(
                    ButtonViewModel(messages("site.save.continue"))
                )
            }
        }
    }
}